---
title: "Vim"
date: 2025-11-26 23:00:00 +0800
categories: [Vim]
tags: [Vim]
---

Vim 是一款功能强大、高度可定制的文本编辑器，以其**高效的键盘操作**著称。虽然它的学习曲线比较陡峭，但一旦掌握，你的编码和编辑速度将会有质的飞跃。

---

### 第一部分：核心概念

Vim 与普通编辑器（如 Notepad、VS Code）最大的区别在于**模式（Modes）**。

1.  **正常模式 (Normal Mode)**：默认模式。用于移动光标、删除文本、复制粘贴。你**不能**直接输入文字。
2.  **插入模式 (Insert Mode)**：用于输入文本。就像普通的编辑器一样。
3.  **命令模式 (Command Mode)**：用于保存、退出、设置环境。
4.  **可视模式 (Visual Mode)**：用于选择文本块。

> **关键习惯**：在这个教程中，如果你不知道自己在什么模式，**狂按 `Esc` 键**，直到回到正常模式。

---

### 第二部分：如何打开、编辑、退出

如果你被困在 Vim 里出不来，请看这里。

#### 1. 打开文件
在终端输入：
```bash
vim filename.txt
```
如果文件不存在，Vim 会新建一个缓冲区。

#### 2. 进入输入模式
刚进去是**正常模式**，打字没反应？
*   按 **`i`** (insert)：在光标前开始输入（最常用）。
*   按 **`a`** (append)：在光标后开始输入。
*   按 **`o`** (open)：在当前行下方新建一行并进入输入模式。

*此时屏幕左下角会出现 `-- INSERT --` 字样，你可以自由打字了。*

#### 3. 回到正常模式
打完字后，按 **`Esc`** 键。左下角的 `-- INSERT --` 消失。

#### 4. 保存与退出（在正常模式下操作）
先按 `:` (冒号) 进入命令模式，屏幕底部会出现输入框：
*   **:w** -> 保存 (Write)
*   **:q** -> 退出 (Quit)
*   **:wq** -> 保存并退出
*   **:q!** -> **强制退出不保存**（如果你改乱了想重来，用这个）

---

### 第三部分：移动与编辑

在**正常模式 (Normal Mode)** 下操作。

#### 1. 光标移动 (基础)
虽然可以用方向键，但 Vim 的精髓在于双手不离主键盘区：
*   **`h`**：左
*   **`j`**：下 (像字母 j 往下掉)
*   **`k`**：上 (像 King 高高在上)
*   **`l`**：右

#### 2. 快速移动
*   **`w`**：跳到下一个单词开头 (word)
*   **`b`**：跳到上一个单词开头 (back)
*   **`0`** (数字0)：跳到行首
*   **`$`**：跳到行尾
*   **`gg`**：跳到文件第一行
*   **`G`**：跳到文件最后一行
*   **`10G`**：跳到第 10 行（数字+G）

#### 3. 删除与撤销
*   **`x`**：删除光标所在的字符
*   **`dd`**：删除（剪切）整行
*   **`dw`**：删除一个单词
*   **`5dd`**：删除 5 行（数字+命令，Vim 的通用逻辑）
*   **`u`**：**撤销** (Undo) —— 救命用的键
*   **`Ctrl + r`**：重做 (Redo)

#### 4. 复制与粘贴
Vim 中复制叫 "Yank" (提起)。
*   **`yy`**：复制整行
*   **`p`**：粘贴 (Paste) 到光标**后**（如果是行，则粘贴到下一行）
*   **`P`**：粘贴到光标**前**

---

### 第四部分：查找与替换

在**正常模式**下操作。

#### 1. 查找
*   **/keyword**：向下查找 "keyword"。
*   **?keyword**：向上查找 "keyword"。
*   **`n`**：跳转到下一个匹配项 (Next)。
*   **`N`**：跳转到上一个匹配项。

#### 2. 替换
*   **:s/old/new**：替换当前行第一个 old 为 new。
*   **:s/old/new/g**：替换当前行所有的 old 为 new (global)。
*   **:%s/old/new/g**：替换**整个文件**中所有的 old 为 new。

---

### 第五部分：可视模式 (选择文本)

有时候你想删除或复制一大段特定的文字，而不是整行。

1.  在正常模式下按 **`v`** 进入可视模式 (Visual)。
2.  使用 `h/j/k/l` 移动光标，你会看到文字被高亮选中。
3.  选中后：
    *   按 **`y`** 复制。
    *   按 **`d`** 删除。
    *   按 **`>`** 缩进。

**进阶技巧：块选择**
按 **`Ctrl + v`** 进入块可视模式。这在处理列数据（如多行注释）时非常有用。

---

### 第六部分：分屏与多文件

*   **:sp filename**：水平分屏打开文件 (Split)。
*   **:vsp filename**：垂直分屏打开文件 (Vertical Split)。
*   **`Ctrl + w`，然后按 `h/j/k/l`**：在不同的屏幕之间切换光标。

---

### 第七部分：简单配置 (.vimrc)

原生的 Vim 界面比较简陋。你可以在用户目录下创建或编辑 `~/.vimrc` 文件来开启常用功能。

在终端执行 `vim ~/.vimrc`，复制以下内容并保存：

```vim
syntax on           " 开启语法高亮
set number          " 显示行号
set relativenumber  " 显示相对行号（高手常用，方便跳转）
set cursorline      " 高亮当前行
set tabstop=4       " Tab键宽度为4个空格
set shiftwidth=4    " 自动缩进宽度
set expandtab       " 将Tab转为空格
set autoindent      " 换行自动缩进
set ignorecase      " 搜索忽略大小写
set smartcase       " 搜索时如果包含大写字母则严格匹配
```

---

### 总结：Vim 速查表

| 功能               | 快捷键/命令     | 助记                   |
| :----------------- | :-------------- | :--------------------- |
| **进入插入模式**   | `i` / `a` / `o` | Insert / Append / Open |
| **退出到正常模式** | `Esc`           | Escape                 |
| **保存退出**       | `:wq`           | Write & Quit           |
| **移动**           | `h` `j` `k` `l` | 左 下 上 右            |
| **跳到行首/尾**    | `0` / `$`       | -                      |
| **跳到文档首/尾**  | `gg` / `G`      | -                      |
| **删除行**         | `dd`            | Delete                 |
| **复制行**         | `yy`            | Yank                   |
| **粘贴**           | `p`             | Paste                  |
| **撤销**           | `u`             | Undo                   |
| **查找**           | `/text`         | -                      |

### tip
1.  **使用 `vimtutor`**：在终端输入 `vimtutor` 并回车，这是 Vim 自带的官方互动教程，大概需要 30 分钟做完。

---

### 提示 found  a swap file by the name "xxx.xxx.swp" ?

出现这个问题通常是因为 **Vim 没有正常退出**（比如终端直接关闭了、电脑断电了、或者 Vim 崩溃了），导致它遗留了一个 **`.swp` (交换文件/临时备份文件)**。

Vim 发现这个文件存在，就会认为：“**警告！上次编辑可能没保存，或者有另一个人正在编辑这个文件！**”

### 解决方法

当你看到这个界面时，Vim 会给你几个选项（红字是快捷键）：

`[O]pen Read-Only, (E)dit anyway, (R)ecover, (D)elete it, (Q)uit, (A)bort`

#### 情况一：你确定上次没保存重要内容（或者已经保存了只是没正常退）
这是最常见的情况。你只想让这个提示消失。

1.  在提示界面，按 **`D`** (Delete it)。
    *   *注意：* 这一步会删除那个残留的交换文件，下次打开就不会报错了。
    *   *如果没有 `D` 选项：* 按 **`Q`** 退出，然后在终端手动删除它（见下方“手动删除法”）。

#### 情况二：你上次写了很多东西没保存，突然崩了
你想找回丢失的代码。

1.  在提示界面，按 **`R`** (Recover)。
2.  Vim 会尝试恢复上次的内容。
3.  如果恢复成功，马上输入 `:w new_filename.txt` **另存为**一个新文件。
4.  退出 Vim。
5.  手动删除原来的 `.swp` 文件。

#### 情况三：你现在正打开着另一个终端也在编辑这个文件
Vim 是在保护你不冲突。

1.  去另一个终端把文件保存并退出即可。
2.  如果你确定要同时开两个（不推荐），按 **`E`** (Edit anyway)。

---

### 手动删除法（最彻底的解决方式）

如果按 `D` 没用，或者你总是无法消除这个提示，你需要手动在终端里把那个隐藏文件删掉。

假设你报错的文件名是 `hello.py`。

1.  **退出 Vim**。
2.  **查看隐藏文件**：
    交换文件通常是隐藏的，文件名是 `.` 开头，`.swp` 结尾。
    在终端输入：
    ```bash
    ls -a
    ```
    你应该能看到一个叫 `.hello.py.swp` 的文件。
3.  **删除它**：
    ```bash
    rm .hello.py.swp
    ```
    *(注意文件名前面有个点)*

再次打开 `hello.py`，提示就会消失了。

### 总结
*   **这是什么？** 它是 Vim 的自动备份机制，防止数据丢失。
*   **怎么解决？** 只要你确定不需要恢复数据，直接**删除那个 `.swp` 文件**即可。